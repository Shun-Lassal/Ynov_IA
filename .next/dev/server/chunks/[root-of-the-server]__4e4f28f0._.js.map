{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/shun/Documents/IA_Ynov/app/api/chat/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\ntype ChatMessage = { role: \"user\" | \"assistant\"; content: string };\n\nconst systemPrompt = `Tu es l'assistant virtuel de TimeTravel Agency, une agence de voyage temporel de luxe.\nTon rôle : conseiller les clients sur les meilleures destinations temporelles.\nTon ton : professionnel, chaleureux, passionné d'histoire, enthousiaste sans être trop familier.\nTu connais parfaitement : Paris 1889 (Belle Époque, Tour Eiffel, Exposition Universelle), Crétacé -65M (dinosaures, nature préhistorique), Florence 1504 (Renaissance, art, Michel-Ange).\nTu peux suggérer des destinations selon les intérêts du client.\nTu peux donner des prix cohérents (ex : 28 000€ à 95 000€ selon durée et exclusivité).\nRéponds en français, avec concision et élégance.`;\n\nexport async function POST(request: Request) {\n  const apiKey = process.env.MISTRAL_API_KEY;\n  if (!apiKey) {\n    return NextResponse.json(\n      { error: \"Clé MISTRAL_API_KEY manquante.\" },\n      { status: 500 }\n    );\n  }\n\n  let body: { messages?: ChatMessage[] } = {};\n  try {\n    body = await request.json();\n  } catch (error) {\n    return NextResponse.json({ error: \"Corps de requête invalide.\" }, { status: 400 });\n  }\n\n  const messages = Array.isArray(body.messages) ? body.messages : [];\n\n  try {\n    const response = await fetch(\"https://api.mistral.ai/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${apiKey}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        model: \"mistral-small-latest\",\n        temperature: 0.7,\n        max_tokens: 350,\n        messages: [\n          { role: \"system\", content: systemPrompt },\n          ...messages.map((message) => ({\n            role: message.role,\n            content: message.content\n          }))\n        ]\n      })\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      return NextResponse.json(\n        { error: errorText || \"Erreur Mistral API.\" },\n        { status: response.status }\n      );\n    }\n\n    const data = (await response.json()) as {\n      choices?: { message?: { content?: string } }[];\n    };\n\n    const reply = data.choices?.[0]?.message?.content?.trim();\n\n    if (!reply) {\n      return NextResponse.json({ error: \"Réponse vide.\" }, { status: 502 });\n    }\n\n    return NextResponse.json({ reply });\n  } catch (error) {\n    return NextResponse.json(\n      { error: \"Impossible de joindre l'API Mistral.\" },\n      { status: 502 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAIA,MAAM,eAAe,CAAC;;;;;;gDAM0B,CAAC;AAE1C,eAAe,KAAK,OAAgB;IACzC,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;IAC1C,IAAI,CAAC,QAAQ;QACX,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAiC,GAC1C;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI,OAAqC,CAAC;IAC1C,IAAI;QACF,OAAO,MAAM,QAAQ,IAAI;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClF;IAEA,MAAM,WAAW,MAAM,OAAO,CAAC,KAAK,QAAQ,IAAI,KAAK,QAAQ,GAAG,EAAE;IAElE,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,8CAA8C;YACzE,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,QAAQ;gBACjC,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,aAAa;gBACb,YAAY;gBACZ,UAAU;oBACR;wBAAE,MAAM;wBAAU,SAAS;oBAAa;uBACrC,SAAS,GAAG,CAAC,CAAC,UAAY,CAAC;4BAC5B,MAAM,QAAQ,IAAI;4BAClB,SAAS,QAAQ,OAAO;wBAC1B,CAAC;iBACF;YACH;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,aAAa;YAAsB,GAC5C;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAE9B;QAEA,MAAM,OAAQ,MAAM,SAAS,IAAI;QAIjC,MAAM,QAAQ,KAAK,OAAO,EAAE,CAAC,EAAE,EAAE,SAAS,SAAS;QAEnD,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAM;IACnC,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuC,GAChD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}